From 191440cf3f6663a281578d03f98a40efccbd6557 Mon Sep 17 00:00:00 2001
From: zhaxie <787631162@qq.com>
Date: Wed, 7 Apr 2021 10:23:18 +0800
Subject: [PATCH] =?UTF-8?q?=E6=8A=BD=E7=A6=BB=E8=8A=82=E6=B5=81=E9=98=B2?=
 =?UTF-8?q?=E6=8A=96=E5=87=BD=E6=95=B0?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 qianduanGaoshouJinJie/js/debounce.js |  8 ++-
 qianduanGaoshouJinJie/js/throttle.js | 79 ++++++++++++++++++++++++++++
 qianduanGaoshouJinJie/throttle.html  |  4 +-
 3 files changed, 87 insertions(+), 4 deletions(-)
 create mode 100644 qianduanGaoshouJinJie/js/throttle.js

diff --git a/qianduanGaoshouJinJie/js/debounce.js b/qianduanGaoshouJinJie/js/debounce.js
index ca14d44..6033700 100644
--- a/qianduanGaoshouJinJie/js/debounce.js
+++ b/qianduanGaoshouJinJie/js/debounce.js
@@ -1,12 +1,16 @@
 /*
  * @Date         : 2021-03-05 15:36:05
  * @LastEditors  : cxx
- * @LastEditTime : 2021-03-05 15:39:21
+ * @LastEditTime : 2021-04-07 10:13:29
  * @FilePath     : \qianduanGaoshouJinJie\js\debounce.js
  */
 
 
-// 代码2
+/**
+ * @description: 防抖
+ * @param {*} func 防抖函数
+ * @param {*} wait 等待时长
+ */
 const debounce = (func, wait = 0) => {
     let timeout = null;
     let args;
diff --git a/qianduanGaoshouJinJie/js/throttle.js b/qianduanGaoshouJinJie/js/throttle.js
new file mode 100644
index 0000000..b7d349c
--- /dev/null
+++ b/qianduanGaoshouJinJie/js/throttle.js
@@ -0,0 +1,79 @@
+/*
+ * @Date         : 2021-04-07 10:14:22
+ * @LastEditors  : cxx
+ * @LastEditTime : 2021-04-07 10:15:19
+ * @FilePath     : \qianduanGaoshouJinJie\js\throttle.js
+ */
+
+/**
+ * @description:  节流
+ * @param {*} func 目标函数
+ * @param {*} wait 等待时长
+ * @param {*} execFirstCall
+ * @return {*}
+ */
+const throttle = (func, wait = 0, execFirstCall) => {
+    let timeout = null;
+    let args;
+    let firstCallTimestamp;
+
+    function throttled(...arg) {
+        if (!firstCallTimestamp) {
+            firstCallTimestamp = new Date().getTime();
+        };
+
+        if (!execFirstCall || !args) {
+            args = arg;
+        }
+        if (timeout) {
+            clearTimeout(timeout);
+            timeout = null;
+        }
+
+        // 以Promise的形式返回函数执行结果
+        return new Promise(async (res, rej) => {
+            if (new Date().getTime() - firstCallTimestamp >= wait) {
+                try {
+                    const result = await func.apply(this, args);
+                    res(result);
+                } catch (e) {
+                    rej(e);
+                } finally {
+                    cancel();
+                }
+            } else {
+                timeout = setTimeout(async () => {
+                    try {
+                        const result = await func.apply(this, args);
+                        res(result);
+                    } catch (e) {
+                        rej(e);
+                    } finally {
+                        cancel();
+                    }
+                }, firstCallTimestamp + wait - new Date().getTime());
+            }
+        })
+    }
+
+    // 允许取消
+    function cancel() {
+        clearTimeout(timeout);
+        args = null;
+        timeout = null;
+        firstCallTimestamp = null;
+    }
+
+    // 允许立即执行
+    function flush() {
+        cancel();
+        return func.apply(this, args);
+    }
+
+    throttled.cancel = cancel;
+    throttled.flush = flush;
+    
+    return throttled;
+}
+
+export default throttle;
\ No newline at end of file
diff --git a/qianduanGaoshouJinJie/throttle.html b/qianduanGaoshouJinJie/throttle.html
index f759d1d..bbabe60 100644
--- a/qianduanGaoshouJinJie/throttle.html
+++ b/qianduanGaoshouJinJie/throttle.html
@@ -1,7 +1,7 @@
 <!--
  * @Date         : 2021-02-25 11:46:13
  * @LastEditors  : cxx
- * @LastEditTime : 2021-02-25 14:17:33
+ * @LastEditTime : 2021-04-07 10:22:53
  * @FilePath     : \qianduanGaoshouJinJie\throttle.html
 -->
 <!DOCTYPE html>
@@ -97,7 +97,7 @@
                 }
 
                 const scrollEndCb = throttle((options) => {
-                    console.info('防抖函数执行', options);
+                    console.info('节流函数执行', options);
                 }, 500, false);
                 
                 //监听
-- 
2.31.1.windows.1

